# APK测试指南 - 儿童产品设计助手 V8.4.0

## 📋 测试环境

### 应用信息
- **应用名称**：儿童产品设计助手
- **包名**：com.childproductdesign.assistant
- **版本**：V8.4.0
- **架构**：Next.js + Capacitor 6

### 最新更新（V8.4.0）
- ✅ **新增法规审核功能**：使用DeepSeek R1模型进行深度审核
- ✅ **修复JSON解析问题**：支持带markdown标记的AI输出
- ✅ **优化系统提示词**：确保AI直接输出纯JSON格式

### 测试场景
- **测试功能**：儿童安全座椅专业设计助手
- **测试输入**：身高范围 40-105cm
- **测试标准**：ECE R129 (i-Size)

---

## 🚀 获取APK

### 方法1：从GitHub Actions下载（推荐）

1. 访问GitHub仓库：`https://github.com/awlei/child-product-design-assistant`
2. 点击 **Actions** 标签
3. 找到最新的 **Build Android APK** 工作流
4. 点击进入工作流详情
5. 在 **Artifacts** 部分，下载 **app-debug-apk**
6. 解压下载的ZIP文件，获取 `app-debug.apk`

### 方法2：从沙箱构建（本地测试）

如果沙箱环境支持，可以执行以下命令：

```bash
# 1. 进入项目目录
cd /workspace/projects/

# 2. 安装依赖
pnpm install

# 3. 构建Web应用
pnpm run build

# 4. 添加Android平台
npx cap add android

# 5. 同步Android平台
npx cap sync android

# 6. 构建APK
cd android
chmod +x gradlew
./gradlew assembleDebug

# 7. APK位置
ls -lh app/build/outputs/apk/debug/app-debug.apk
```

---

## 📱 安装APK

### Android设备安装

1. **启用未知来源应用**
   - 打开手机 **设置**
   - 进入 **安全** 或 **隐私**
   - 启用 **允许安装未知来源应用**

2. **安装APK**
   - 将 `app-debug.apk` 传输到手机
   - 点击APK文件开始安装
   - 按照提示完成安装

3. **首次启动**
   - 安装完成后，点击 **打开**
   - 应用会请求网络权限（必须允许）
   - 进入应用主页

### Android模拟器安装

1. **启动模拟器**
   ```bash
   # 使用Android Studio启动模拟器
   emulator -avd <your_avd_name>
   ```

2. **安装APK**
   ```bash
   adb install app-debug.apk
   ```

3. **启动应用**
   ```bash
   adb shell am start -n com.childproductdesign.assistant/.MainActivity
   ```

---

## 🧪 测试步骤

### 测试1：启动应用

**预期结果**：
- ✅ 应用启动成功
- ✅ 显示首页"儿童产品设计助手"
- ✅ 网络连接正常（检查右上角版本号V8.3.0）

**截图要点**：
- 应用启动画面
- 首页完整展示
- 5个功能卡片

### 测试2：进入儿童安全座椅功能

**操作步骤**：
1. 在首页点击 **儿童安全座椅** 卡片
2. 进入"儿童安全座椅专业设计助手"页面

**预期结果**：
- ✅ 页面标题显示"儿童安全座椅专业设计助手"
- ✅ 副标题显示"ECE R129 (i-Size) / FMVSS 213 / ECE R44 · 安全第一 · 专业设计"
- ✅ 右上角显示版本号V8.3.0
- ✅ 显示调试按钮（Bug图标）

**截图要点**：
- 页面完整布局
- 输入表单区域

### 测试3：输入身高范围

**操作步骤**：
1. 在"选择安全标准"下拉框中，选择 **ECE R129 (i-Size) - 基于身高（推荐）**
2. 在"最小身高 (cm)"输入框中，输入 **40**
3. 在"最大身高 (cm)"输入框中，输入 **105**

**预期结果**：
- ✅ 安全标准选择成功
- ✅ 最小身高显示40
- ✅ 最大身高显示105
- ✅ 无错误提示

**截图要点**：
- 输入表单完整填写
- 输入值清晰可见

### 测试4：生成设计建议

**操作步骤**：
1. 点击 **"生成设计建议"** 按钮
2. 等待AI生成（约5-15秒）

**预期结果**：
- ✅ 按钮显示"正在生成设计建议..."
- ✅ 显示加载动画（旋转图标）
- ✅ 生成完成后显示设计报告

**截图要点**：
- 加载状态
- 加载动画

### 测试5：查看设计报告

**预期结果**：

#### 模块01：产品定位与适用标准
- ✅ 显示紫色徽章 `01`
- ✅ 显示ShieldCheck图标
- ✅ 显示标题"产品定位与适用标准"
- ✅ 显示紫色背景卡片
- ✅ 内容包含：
  - 儿童年龄段（如15-36个月）
  - 适用市场区域（欧洲/北美/全球）
  - 核心差异化卖点

#### 模块02：关键技术要求
- ✅ 显示蓝色徽章 `02`
- ✅ 显示Settings图标
- ✅ 显示标题"关键技术要求"
- ✅ 显示3-5条技术要求
- ✅ 每条要求有编号圆圈（1、2、3...）
- ✅ 每条要求在蓝色背景卡片中

#### 模块03：核心安全功能推荐
- ✅ 显示绿色徽章 `03`
- ✅ 显示ShieldCheck图标
- ✅ 显示标题"核心安全功能推荐"
- ✅ 显示3-5个安全功能
- ✅ 每个功能有编号圆圈（1、2、3...）
- ✅ 每个功能包含：
  - 功能名称
  - 技术实现
  - 安全价值

#### 模块04：重要安全提醒
- ✅ 显示红色徽章 `04`
- ✅ 显示AlertCircle图标
- ✅ 显示标题"重要安全提醒"
- ✅ 显示4条安全提醒
- ✅ 背景为红色

**截图要点**：
- 4个模块完整展示
- 每个模块的序号徽章
- 模块3的编号圆圈
- 整体布局

### 测试6：法规审核功能（V8.4.0新增）

**操作步骤**：
1. 在设计报告下方，找到"启动法规合规性审核"按钮
2. 点击该按钮
3. 等待审核完成（约10-30秒）

**预期结果**：
- ✅ 按钮显示"正在审核报告..."
- ✅ 显示加载动画（旋转图标）
- ✅ 审核完成后显示审核结果卡片

#### 审核结果展示

**审核通过**（90-100分）：
- ✅ 卡片边框为绿色
- ✅ 显示CheckCircle图标（绿色）
- ✅ 显示"审核通过"文字
- ✅ 显示分数徽章（如95分，绿色）
- ✅ 显示审核摘要
- ✅ 显示改进建议（如果有）

**审核未通过**（0-89分）：
- ✅ 卡片边框为红色
- ✅ 显示X图标（红色）
- ✅ 显示"审核未通过"文字
- ✅ 显示分数徽章（根据分数显示不同颜色）
  - 70-89分：蓝色
  - 50-69分：黄色
  - 0-49分：红色
- ✅ 显示审核摘要
- ✅ 显示问题列表（按严重性分类）：
  - 高：红色背景，红色徽章
  - 中：黄色背景，黄色徽章
  - 低：蓝色背景，蓝色徽章
- ✅ 每个问题显示：
  - 问题类型
  - 问题描述
  - 改进建议
- ✅ 显示改进建议列表（编号列表）

**截图要点**：
- 审核按钮加载状态
- 审核结果卡片
- 问题列表（如有）
- 分数徽章

---

## 🐛 异常情况处理

### 场景1：生成报告格式错误

**可能原因**：
- DOUBAO_API_KEY未配置
- 网络连接问题
- AI服务超时

**预期结果**：
- ✅ 显示错误卡片（红色背景）
- ✅ 显示错误消息："API request failed: 401" 或其他错误
- ✅ 显示Bug图标
- ✅ 点击Bug图标可展开调试信息
- ✅ 调试信息显示AI原始输出预览

**截图要点**：
- 错误卡片完整展示
- 错误详细信息
- 调试信息展开

### 场景2：输入验证错误

**测试输入**：
- 最小身高：105，最大身高：40（最小值大于最大值）

**预期结果**：
- ✅ 显示错误提示："身高范围无效，请输入40-150cm之间的有效范围"
- ✅ 错误提示在红色背景卡片中
- ✅ AlertCircle图标

**截图要点**：
- 错误提示展示

### 场景3：网络错误

**测试步骤**：
1. 断开网络连接
2. 点击"生成设计建议"

**预期结果**：
- ✅ 显示网络错误提示
- ✅ 错误信息清晰

**截图要点**：
- 网络错误提示

---

## 📊 测试报告模板

### 基本信息
- **测试日期**：YYYY-MM-DD
- **测试人员**：XXX
- **设备型号**：XXX
- **Android版本**：XXX
- **APK版本**：V8.4.0

### 测试结果

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 应用启动 | ⬜ 通过 / ❌ 失败 | |
| 进入功能页面 | ⬜ 通过 / ❌ 失败 | |
| 输入身高40-105 | ⬜ 通过 / ❌ 失败 | |
| 生成设计建议 | ⬜ 通过 / ❌ 失败 | |
| JSON格式解析 | ⬜ 通过 / ❌ 失败 | |
| 查看模块01 | ⬜ 通过 / ❌ 失败 | |
| 查看模块02 | ⬜ 通过 / ❌ 失败 | |
| 查看模块03 | ⬜ 通过 / ❌ 失败 | |
| 查看模块04 | ⬜ 通过 / ❌ 失败 | |
| 模块序号显示 | ⬜ 通过 / ❌ 失败 | |
| 法规审核按钮 | ⬜ 通过 / ❌ 失败 | |
| 审核结果展示 | ⬜ 通过 / ❌ 失败 | |
| 问题列表显示 | ⬜ 通过 / ❌ 失败 | |
| 分数徽章显示 | ⬜ 通过 / ❌ 失败 | |
| 调试功能 | ⬜ 通过 / ❌ 失败 | |

### 问题记录

| 问题ID | 问题描述 | 严重程度 | 截图 |
|--------|----------|----------|------|
| P001 | | 高/中/低 | |
| P002 | | 高/中/低 | |

### 建议
- 功能改进建议
- UI优化建议
- 性能优化建议

---

## 📝 注意事项

### API Key配置
当前APK使用的是开发环境配置，**DOUBAO_API_KEY需要在服务器端配置**。如果测试时遇到401错误：

1. 联系开发团队配置API Key
2. 或者等待正式版本发布

### 网络权限
首次启动时，应用会请求网络权限，**必须允许**，否则无法使用AI生成功能。

### 测试环境建议
- ✅ 使用Android 8.0+设备
- ✅ 确保网络连接稳定
- ✅ 关闭VPN（可能影响API调用）
- ✅ 使用时区设置为本地时区

---

## 🎯 快速测试清单

- [ ] APK成功安装
- [ ] 应用启动成功
- [ ] 进入儿童安全座椅页面
- [ ] 输入身高40-105
- [ ] 点击生成设计建议
- [ ] 查看模块01（产品定位）
- [ ] 查看模块02（技术要求）
- [ ] 查看模块03（安全功能）
- [ ] 查看模块04（安全提醒）
- [ ] 确认所有模块序号显示正确
- [ ] 测试调试按钮功能

---

## 📞 问题反馈

如发现问题，请提供以下信息：

1. **问题描述**：详细描述问题现象
2. **复现步骤**：如何重现问题
3. **设备信息**：设备型号、Android版本
4. **截图/录屏**：问题截图或录屏
5. **错误日志**：如果可能，提供错误日志

---

**最后更新**：2025-01-XX
**文档版本**：V1.0
