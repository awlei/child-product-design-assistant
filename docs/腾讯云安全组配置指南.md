# 腾讯云安全组配置指南 - 开放5000端口

## 📌 问题说明

当前服务已正常运行在 `0.0.0.0:5000`，但由于腾讯云安全组未开放5000端口，导致外网无法访问。

**服务器信息：**
- 公网IP：9.129.222.155
- 服务端口：5000
- 访问地址：http://9.129.222.155:5000

## 🔧 配置步骤（图文说明）

### 步骤1：登录腾讯云控制台

1. 打开浏览器访问：https://console.cloud.tencent.com/
2. 使用您的账号密码登录

### 步骤2：进入云服务器控制台

1. 在顶部搜索框输入"云服务器"或"CVM"
2. 点击进入"云服务器"控制台

### 步骤3：找到您的服务器实例

1. 在"实例"列表中，找到IP为 `9.129.222.155` 的服务器
2. 点击该实例的名称或ID进入详情页

### 步骤4：进入安全组配置

**路径：**
```
实例详情页 → 左侧菜单"安全组" → 点击"配置规则"
```

或者：
```
实例列表 → 操作列 → 更多 → 安全组 → 配置安全组
```

### 步骤5：添加入站规则

1. 在"入站规则"标签页，点击"添加规则"按钮
2. 填写以下信息：

| 字段 | 值 | 说明 |
|------|-----|------|
| 类型 | 自定义 | 选择自定义规则 |
| 协议端口 | TCP:5000 | 开放TCP协议的5000端口 |
| 来源 | 0.0.0.0/0 | 允许所有IP访问 |
| 策略 | 允许 | 允许流量通过 |
| 备注 | 儿童安全座椅PWA | 可选，便于识别 |

3. 点击"保存"

### 步骤6：验证配置

**在服务器上验证：**
```bash
# 服务已监听在0.0.0.0:5000
ss -lptn | grep 5000
# 应显示：LISTEN 0 511 0.0.0.0:5000 0.0.0.0:*
```

**在本地电脑验证：**
```bash
# Windows (PowerShell)
Test-NetConnection -ComputerName 9.129.222.155 -Port 5000

# macOS/Linux
nc -zv 9.129.222.155 5000

# Windows (cmd)
telnet 9.129.222.155 5000
```

**浏览器验证：**
```
http://9.129.222.155:5000
```

如果看到应用页面，说明配置成功！

## 📸 配置界面示意

```
┌─────────────────────────────────────────────┐
│  腾讯云控制台 - 云服务器                    │
├─────────────────────────────────────────────┤
│                                             │
│  实例列表                                   │
│  ┌─────────────────────────────────────┐   │
│  │ [9.129.222.155] [运行中] [查看]    │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  点击进入实例详情 → 安全组 → 配置规则       │
└─────────────────────────────────────────────┘

┌─────────────────────────────────────────────┐
│  安全组规则配置                              │
├─────────────────────────────────────────────┤
│                                             │
│  入站规则                                   │
│  ┌─────────────────────────────────────┐   │
│  │ 添加规则                             │   │
│  │                                     │   │
│  │ 类型：自定义 [▼]                    │   │
│  │ 协议端口：TCP:5000                  │   │
│  │ 来源：0.0.0.0/0                     │   │
│  │ 策略：允许 [✓]                      │   │
│  │ 备注：儿童安全座椅PWA                │   │
│  │                                     │   │
│  │ [取消] [保存]                        │   │
│  └─────────────────────────────────────┘   │
└─────────────────────────────────────────────┘
```

## ✅ 配置检查清单

配置完成后，请确认以下各项：

- [ ] 在腾讯云控制台找到了正确的服务器实例
- [ ] 添加的是"入站规则"而不是"出站规则"
- [ ] 协议端口设置为 `TCP:5000`
- [ ] 来源IP设置为 `0.0.0.0/0`（允许所有IP）
- [ ] 策略选择"允许"
- [ ] 点击了"保存"按钮
- [ ] 等待了3-5分钟让规则生效

## 📱 配置成功后的操作

### 1. 在手机浏览器访问

**安卓手机：**
1. 打开Chrome浏览器
2. 访问：http://9.129.222.155:5000
3. 看到应用页面后，点击顶部的"立即安装"按钮
4. 完成安装

**iOS手机：**
1. 打开Safari浏览器
2. 访问：http://9.129.222.155:5000
3. 点击底部分享按钮（⬆️）
4. 选择"添加到主屏幕"

### 2. 验证PWA安装

- [ ] 主屏幕出现"座椅助手"图标
- [ ] 点击图标后全屏运行
- [ ] 可以离线使用

## ⚠️ 常见问题

### Q1: 配置后还是无法访问？

**检查项：**

1. **等待时间不够**
   - 安全组规则可能需要1-3分钟生效
   - 请等待3-5分钟后重试

2. **规则配置错误**
   - 确认配置的是"入站规则"
   - 确认来源是 `0.0.0.0/0`
   - 确认策略是"允许"

3. **多个安全组**
   - 检查实例是否绑定了多个安全组
   - 确保所有安全组都开放了5000端口
   - 或者创建一个新的安全组，只开放必要的端口

4. **网络ACL**
   - 检查子网的网络ACL配置
   - 确保网络ACL允许5000端口流量

### Q2: 找不到安全组配置入口？

**完整路径：**
```
腾讯云控制台
  ↓
云服务器 CVM
  ↓
实例列表
  ↓
选择实例 9.129.222.155
  ↓
左侧菜单：安全组
  ↓
配置规则
  ↓
添加规则
```

### Q3: 没有权限配置安全组？

**解决方案：**

1. **联系管理员**
   - 说明需要开放TCP 5000端口
   - 提供服务器IP：9.129.222.155
   - 说明用途：PWA应用外网访问

2. **申请权限**
   - 向管理员申请云服务器管理权限
   - 或申请安全组配置权限

### Q4: 端口配置提示错误？

**可能原因：**
- 端口被占用（5000端口）
- 规则数量达到上限
- 输入格式不正确

**解决方案：**
- 检查端口配置格式：`TCP:5000`
- 确保没有使用特殊字符
- 联系腾讯云技术支持

### Q5: 如何限制访问来源？

**为了安全，可以限制来源IP：**

```
来源选项：
- 0.0.0.0/0      允许所有IP访问（所有人都能访问）
- 1.2.3.4/32     只允许特定IP访问
- 1.2.3.0/24     只允许特定网段访问
```

**示例：只允许您的IP访问**
```
来源：您的公网IP/32
```

## 🔒 安全建议

### 基础安全配置

**1. 限制来源IP（推荐）**
```
来源：您的固定公网IP/32
```

**2. 添加防火墙规则**
```bash
# 在服务器上添加防火墙规则（如果有iptables）
sudo iptables -A INPUT -p tcp --dport 5000 -j ACCEPT
sudo iptables-save
```

**3. 配置HTTPS（强烈推荐）**
- 使用Let's Encrypt免费证书
- 配置nginx反向代理
- 强制HTTPS跳转

### 临时配置（测试用）

如果只是为了测试，可以使用 `0.0.0.0/0` 允许所有IP访问。

**生产环境建议：**
- 限制来源IP
- 配置HTTPS
- 使用防火墙
- 定期审计访问日志

## 📞 技术支持

如果以上方法都无法解决，请联系：

1. **腾讯云技术支持**
   - 控制台：提交工单
   - 电话：95716

2. **腾讯云文档**
   - 安全组文档：https://cloud.tencent.com/document/product/213/39740

## 📝 配置记录

**记录您的配置：**

```
配置时间：_____________
配置人：_____________
服务器IP：9.129.222.155
开放端口：TCP 5000
来源IP：0.0.0.0/0
备注：儿童安全座椅PWA应用
```

---

**重要提醒：**
- ✅ 服务已正常运行在 0.0.0.0:5000
- ⚠️ 只需配置云服务器安全组即可外网访问
- 📱 配置成功后即可安装到手机

**预计生效时间：** 1-3分钟
**访问地址：** http://9.129.222.155:5000

---

**最后更新：** 2025-01-22
**文档版本：** V1.0
